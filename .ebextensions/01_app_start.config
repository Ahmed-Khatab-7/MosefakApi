files:
  "C:\\monitor_app_start.ps1":
    content: |
      Start-Transcript -Path "C:\install_logs\app_start_monitor.log"
      
      Write-Host "Checking application startup..."
      $maxAttempts = 5
      $attemptCount = 0
      $started = $false
      
      while ($attemptCount -lt $maxAttempts -and -not $started) {
        $attemptCount++
        Write-Host "Attempt $attemptCount of $maxAttempts"
        
        try {
          # Check if application is running
          $processName = "dotnet"
          $processes = Get-Process -Name $processName -ErrorAction SilentlyContinue
          
          if ($processes) {
            foreach ($process in $processes) {
              Write-Host "Found dotnet process: $($process.Id), Command line: $($process.CommandLine)"
            }
            $started = $true
            Write-Host "Application appears to be running"
          } else {
            Write-Host "No dotnet processes found, waiting 10 seconds..."
            Start-Sleep -Seconds 10
          }
        }
        catch {
          Write-Host "Error checking process: $_"
          Start-Sleep -Seconds 5
        }
      }
      
      if ($started) {
        Write-Host "Application started successfully."
      } else {
        Write-Host "Application failed to start after $maxAttempts attempts."
      }
      
      Stop-Transcript

commands:
  01_monitor_app_start:
    command: powershell.exe -ExecutionPolicy Bypass -File "C:\\monitor_app_start.ps1"
    ignoreErrors: true
