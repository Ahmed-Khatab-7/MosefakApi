files:
  "C:\\Program Files\\Amazon\\ElasticBeanstalk\\config\\taillogs.d\\dotnetinstall.conf" :
    mode: "000755"
    owner: root
    group: root
    content: |
      C:\cfn\log\dotnetinstall.log

commands:
  01_download_dotnet:
    command: |
      powershell -Command "New-Item -Path C:\cfn\log -ItemType Directory -Force | Out-Null"
      powershell -Command "Start-Transcript -Path 'C:\cfn\log\dotnetinstall.log' -Append"
      powershell -Command "Write-Output 'Starting .NET 9.0 installation...'"
      powershell -Command "$ProgressPreference = 'SilentlyContinue'; Invoke-WebRequest -Uri 'https://download.visualstudio.microsoft.com/download/pr/68574b0e-d96a-4113-9daf-af5f0f1bf5e1/9ce0e24bed25b8318b1176fb117efe6e/dotnet-sdk-9.0.100-win-x64.exe' -OutFile 'C:\Windows\Temp\dotnet_installer.exe'"
      powershell -Command "Write-Output 'Installer downloaded, running installation...'"
      powershell -Command "Start-Process -FilePath 'C:\Windows\Temp\dotnet_installer.exe' -ArgumentList '/install','/quiet','/norestart' -Wait"
      powershell -Command "Write-Output '.NET installation completed with exit code: $LASTEXITCODE'"
      powershell -Command "dotnet --list-sdks"
      powershell -Command "dotnet --list-runtimes"
      powershell -Command "Stop-Transcript"
    ignoreErrors: true
