files:
  "C:\\install_dotnet9.ps1":
    content: |
      Start-Transcript -Path "C:\install_logs\dotnet9_install.log"
      
      Write-Host "Starting .NET 9 installation process..."
      
      # Create directory for hosting bundle
      New-Item -ItemType Directory -Force -Path "C:\dotnet-installer"
      
      # Download .NET 9 Hosting Bundle
      Write-Host "Downloading .NET 9 Hosting Bundle..."
      $ProgressPreference = 'SilentlyContinue'
      Invoke-WebRequest -Uri "https://download.visualstudio.microsoft.com/download/pr/db7a994c-0bf4-4635-8643-ea77933d74db/babaa7bd64dcd35ab7532be90d2ffd4c/dotnet-hosting-9.0.0-win.exe" -OutFile "C:\dotnet-installer\dotnet-hosting-9.0.0-win.exe"
      
      # Install .NET 9 Hosting Bundle
      Write-Host "Installing .NET 9 Hosting Bundle..."
      $process = Start-Process -FilePath "C:\dotnet-installer\dotnet-hosting-9.0.0-win.exe" -ArgumentList "/install", "/quiet", "/norestart" -Wait -PassThru
      Write-Host "Installation completed with exit code: $($process.ExitCode)"
      
      # Restart IIS to apply changes
      Write-Host "Restarting IIS..."
      iisreset /restart
      
      # Verify installation
      Write-Host "Verifying .NET installation..."
      dotnet --list-runtimes
      dotnet --info
      
      Write-Host "Installation process complete."
      
      Stop-Transcript

commands:
  01_create_log_dir:
    command: powershell.exe -Command "New-Item -ItemType Directory -Force -Path 'C:\install_logs'"
  
  02_run_dotnet_installer:
    command: powershell.exe -ExecutionPolicy Bypass -File "C:\\install_dotnet9.ps1"
    ignoreErrors: true
    
  03_set_environment_path:
    command: powershell.exe -Command "[Environment]::SetEnvironmentVariable('PATH', $env:PATH + ';C:\Program Files\dotnet', [EnvironmentVariableTarget]::Machine)"
